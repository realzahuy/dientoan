<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C√¥ng c·ª• Encrypt/Decrypt - AES-256</title>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
  <div class="gradient-bg">
    <div style="max-width: 1200px; width: 100%; padding: 20px;">
      <div class="text-center mb-3">
        <h1 style="color: white; margin-bottom: 10px;">üîê C√¥ng c·ª• Encrypt/Decrypt nhanh</h1>
        <p style="color: rgba(255,255,255,0.9); margin-bottom: 20px;">M√£ h√≥a v√† gi·∫£i m√£ file ngay l·∫≠p t·ª©c, kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p</p>
        <a href="index.html" class="link" style="color: white;">‚Üê Quay l·∫°i trang ch·ªß</a>
      </div>
      
      <div class="tool-container">
        <!-- Encrypt Card -->
        <div class="tool-card">
          <h2>üîí M√£ h√≥a File</h2>
          
          <div id="encryptMessage"></div>
          
          <form id="encryptForm">
            <div class="form-group">
              <label for="encryptFile">Ch·ªçn file</label>
              <input type="file" id="encryptFile" class="form-control" required>
            </div>
            
            <div class="form-group">
              <label for="encryptPassword">M·∫≠t kh·∫©u m√£ h√≥a</label>
              <input type="password" id="encryptPassword" class="form-control" required>
            </div>
            
            <button type="submit" class="btn btn-primary btn-block">M√£ h√≥a v√† t·∫£i xu·ªëng</button>
          </form>
        </div>
        
        <!-- Decrypt Card -->
        <div class="tool-card">
          <h2>üîì Gi·∫£i m√£ File</h2>
          
          <div id="decryptMessage"></div>
          
          <form id="decryptForm">
            <div class="form-group">
              <label for="decryptFile">Ch·ªçn file .enc</label>
              <input type="file" id="decryptFile" class="form-control" accept=".enc" required>
            </div>
            
            <div class="form-group">
              <label for="decryptPassword">M·∫≠t kh·∫©u gi·∫£i m√£</label>
              <input type="password" id="decryptPassword" class="form-control" required>
            </div>
            
            <button type="submit" class="btn btn-secondary btn-block">Gi·∫£i m√£ v√† t·∫£i xu·ªëng</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Encrypt Form
    const encryptForm = document.getElementById('encryptForm');
    const encryptMessage = document.getElementById('encryptMessage');
    
    encryptForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const fileInput = document.getElementById('encryptFile');
      const password = document.getElementById('encryptPassword').value;
      
      if (!fileInput.files[0]) {
        encryptMessage.innerHTML = '<div class="alert alert-error">Vui l√≤ng ch·ªçn file</div>';
        return;
      }
      
      const formData = new FormData();
      formData.append('file', fileInput.files[0]);
      formData.append('password', password);
      
      try {
        encryptMessage.innerHTML = '<div class="alert alert-success">ƒêang m√£ h√≥a...</div>';
        
        const response = await fetch('/tool/encrypt', {
          method: 'POST',
          body: formData
        });
        
        if (response.ok) {
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = fileInput.files[0].name + '.enc';
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
          document.body.removeChild(a);
          
          encryptMessage.innerHTML = '<div class="alert alert-success">M√£ h√≥a th√†nh c√¥ng! File ƒë√£ ƒë∆∞·ª£c t·∫£i xu·ªëng.</div>';
          encryptForm.reset();
        } else {
          const data = await response.json();
          encryptMessage.innerHTML = `<div class="alert alert-error">${data.error}</div>`;
        }
      } catch (error) {
        encryptMessage.innerHTML = '<div class="alert alert-error">L·ªói k·∫øt n·ªëi server</div>';
      }
    });
    
    // Decrypt Form
    const decryptForm = document.getElementById('decryptForm');
    const decryptMessage = document.getElementById('decryptMessage');
    
    decryptForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const fileInput = document.getElementById('decryptFile');
      const password = document.getElementById('decryptPassword').value;
      
      if (!fileInput.files[0]) {
        decryptMessage.innerHTML = '<div class="alert alert-error">Vui l√≤ng ch·ªçn file</div>';
        return;
      }
      
      const formData = new FormData();
      formData.append('file', fileInput.files[0]);
      formData.append('password', password);
      
      try {
        decryptMessage.innerHTML = '<div class="alert alert-success">ƒêang gi·∫£i m√£...</div>';
        
        const response = await fetch('/tool/decrypt', {
          method: 'POST',
          body: formData
        });
        
        if (response.ok) {
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          
          // L·∫•y t√™n file t·ª´ header ho·∫∑c b·ªè .enc
          let filename = fileInput.files[0].name;
          if (filename.endsWith('.enc')) {
            filename = filename.slice(0, -4);
          }
          a.download = filename;
          
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
          document.body.removeChild(a);
          
          decryptMessage.innerHTML = '<div class="alert alert-success">Gi·∫£i m√£ th√†nh c√¥ng! File ƒë√£ ƒë∆∞·ª£c t·∫£i xu·ªëng.</div>';
          decryptForm.reset();
        } else {
          const data = await response.json();
          decryptMessage.innerHTML = `<div class="alert alert-error">${data.error}</div>`;
        }
      } catch (error) {
        decryptMessage.innerHTML = '<div class="alert alert-error">L·ªói k·∫øt n·ªëi server</div>';
      }
    });
  </script>
</body>
</html>
